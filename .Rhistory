mape_test
rmse_test <- sqrt(sum(test.data$se)/length(test.data$se))
rmse_test
cor(test.data$REXONASales,test.data$predicted_sales)^2
m3 = lm(log(REXONASales/(1-REXONASales))~ REXONADISP+REXONAFEAT+REXONADF+REXONAPrice+DOVEPrice+AXEDISP+pricewar_dum,train.data) #R2=0.77
summary(m3)
coefplot(m3, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
#Heterosedasticity test
gqtest(log(REXONASales)~REXONADISP+REXONAFEAT+REXONADF+REXONAPrice+DOVEPrice+AXEDISP,data=train.data)
train.data <- train.data %>%
mutate(ln_salesprime = -0.7091 + 1.0019 * REXONADISP -0.5874 * REXONAFEAT +
2.6273 * REXONADF -1.0600 * REXONAPrice + 0.7246* DOVEPrice -0.5999 * AXEDISP)
train.data <- train.data %>%
mutate(sales_prime = exp(1)^lnsales_2)
train.data <- train.data %>%
mutate(predicted_sales_2 = (sales_prime/(1+sales_prime)))
train.data <- train.data %>%
mutate(se_2 = (REXONASales - predicted_sales_2)^2)
train.data <- train.data %>%
mutate(ape_2 = abs((REXONASales - predicted_sales_2)/REXONASales))
mape_train_2 = sum(train.data$ape_2)/length(train.data$ape_2)
mape_train_2
rmse_train_2 <- sqrt(sum(train.data$se_2)/length(train.data$se_2))
rmse_train_2
cor(train.data$REXONASales,train.data$predicted_sales_2)^2
test.data <- test.data %>%
mutate(lnsales_2 = -1.12278 + 0.75306 * REXONADISP -0.72086 * REXONAFEAT +
1.83470 * REXONADF -0.76310 * REXONAPrice + 0.51854* DOVEPrice -0.44669 * AXEDISP)
test.data <- test.data %>%
mutate(predicted_sales_2 = exp(1) ^ lnsales_2)
test.data <- test.data %>%
mutate(se_2 = (REXONASales - predicted_sales_2)^2)
test.data <- test.data %>%
mutate(ape_2 = abs((REXONASales - predicted_sales_2)/REXONASales))
mape_test_2 = sum(test.data$ape_2)/length(test.data$ape_2)
mape_test_2
rmse_test_2 <- sqrt(sum(test.data$se_2)/length(test.data$se_2))
rmse_test_2
cor(test.data$REXONASales,test.data$predicted_sales_2)^2
coefplot(m3, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
#Heterosedasticity test
gqtest(log(REXONASales)~REXONADISP+REXONAFEAT+REXONADF+REXONAPrice+DOVEPrice+AXEDISP,data=train.data)
train.data <- train.data %>%
mutate(ln_salesprime = -0.7091 + 1.0019 * REXONADISP -0.5874 * REXONAFEAT +
2.6273 * REXONADF -1.0600 * REXONAPrice + 0.7246* DOVEPrice -0.5999 * AXEDISP)
summary(m3)
train.data <- train.data %>%
mutate(ln_salesprime = 0.6774 + 0.87259 * REXONADISP -0.5138 * REXONAFEAT +
2.5047 * REXONADF -1.1442 * REXONAPrice + 0.3451* DOVEPrice -0.6116 * AXEDISP-0.4268*pricewar_dum)
train.data <- train.data %>%
mutate(sales_prime = exp(1)^ln_salesprime)
train.data <- train.data %>%
mutate(predicted_sales_2 = (sales_prime/(1+sales_prime)))
train.data <- train.data %>%
mutate(se_2 = (REXONASales - predicted_sales_2)^2)
train.data <- train.data %>%
mutate(ape_2 = abs((REXONASales - predicted_sales_2)/REXONASales))
mape_train_2 = sum(train.data$ape_2)/length(train.data$ape_2)
mape_train_2
rmse_train_2 <- sqrt(sum(train.data$se_2)/length(train.data$se_2))
rmse_train_2
cor(train.data$REXONASales,train.data$predicted_sales_2)^2
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONAPrice)+log(pricewar_dum+1),train.data) #R2=0.72
summary(m2)
coefplot(m2, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
mutate(REXONAPrice = ifelse(train.data$REXONAPrice == 0,mean(train.data[train.data$REXONAPrice!=0]$REXONAPrice),train.data$REXONAPrice))
df = train.data[train.data$REXONAPrice!=0]
df = mean(train.data$REXONAPrice != 0)
df
df = subset(train.data,REXONAPrice !=0)
df
View(df)
df = subset(train.data,REXONARPrice !=0)
df
View(df)
train.data  <- data1[1:100, ]
train.data = train.data%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
df = subset(train.data,REXONARPrice !=0)
train.data = train.data%>%
mutate(REXONAPrice = ifelse(train.data$REXONARPrice == 0,mean(df$REXONARPrice),train.data$REXONARPrice))
View(train.data)
# Split the data into training and test set
train.data  <- data1[1:100, ]
train.data = train.data%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
df = subset(train.data,REXONARPrice !=0)
train.data = train.data%>%
mutate(REXONARPrice = ifelse(train.data$REXONARPrice == 0,mean(df$REXONARPrice),train.data$REXONARPrice))
df = train.data[,C('REXONARPrice')]
df = train.data[,C('REXONARPrice')]
df = train.data[:,C('REXONARPrice')]
View(train.data)
mean(df$REXONARPrice)
train.data = train.data%>%
mutate(REXONADiscount = (train.data$REXONARPrice-train.data$REXONAPrice)/train.data$REXONARPrice)
View(train.data)
train.data = train.data%>%
mutate(REXONADiscount = (train.data$REXONARPrice-train.data$REXONAPrice)/train.data$REXONARPrice*100)
df2= train.data[:,c('week','REXONARPrice','REXONAPrice','REXONADiscount')]
df2= train.data[,c('week','REXONARPrice','REXONAPrice','REXONADiscount')]
df2= train.data[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
View(df2)
df = subset(data1,REXONARPrice !=0)
data1 = data1%>%
mutate(REXONARPrice = ifelse(data1$REXONARPrice == 0,mean(df$REXONARPrice),data1$REXONARPrice))
data1 = data1%>%
mutate(REXONADiscount = (data1$REXONARPrice-data1$REXONAPrice)/data1$REXONARPrice*100)
df2= data1[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
# Split the data into training and test set
train.data  <- data1[1:100, ]
train.data = train.data%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
test.data <- data1[101:124, ]
chart.Correlation(train.data[,c(6,14,29,45,37,34,19)], histogram=TRUE, pch=19)  # Transforing is necessary
m1 = lm(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+REXONADiscount,train.data) #R2=0.77
summary(m1)
RSS <- c(crossprod(m1$residuals))
MSE <- RSS / length(m1$residuals)
RMSE1 <- sqrt(MSE)
sig2 <- RSS / m1$df.residual
predictions1 <- m1 %>% predict(train.data)
data.frame(
RMSE = RMSE(predictions1, train.data$REXONASales),
R2 = R2(predictions1, train.data$REXONASales)
)
MAPE(predictions1,train.data$REXONASales)
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount),train.data) #R2=0.72
summary(m2)
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1),train.data) #R2=0.72
summary(m2)
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1.1),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+2),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1000),train.data) #R2=0.72
df = subset(data1,REXONARPrice !=0)
data1 = data1%>%
mutate(REXONARPrice = ifelse(data1$REXONARPrice == 0,mean(df$REXONARPrice),data1$REXONARPrice))
data1 = data1%>%
mutate(REXONADiscount = (data1$REXONARPrice-data1$REXONAPrice)/data1$REXONARPrice)
df2= data1[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
# Split the data into training and test set
train.data  <- data1[1:100, ]
train.data = train.data%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
test.data <- data1[101:124, ]
chart.Correlation(train.data[,c(6,14,29,45,37,34,19)], histogram=TRUE, pch=19)  # Transforing is necessary
#Model1
m1 = lm(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+REXONADiscount,train.data) #R2=0.77
summary(m1)
RSS <- c(crossprod(m1$residuals))
MSE <- RSS / length(m1$residuals)
RMSE1 <- sqrt(MSE)
sig2 <- RSS / m1$df.residual
predictions1 <- m1 %>% predict(train.data)
data.frame(
RMSE = RMSE(predictions1, train.data$REXONASales),
R2 = R2(predictions1, train.data$REXONASales)
)
MAPE(predictions1,train.data$REXONASales)
dwtest(m1)
dwtest(m2)
dwtest(m3)
acf(m1$residuals)
acf(m2$residuals)
acf(m3$residuals)
coefplot(m1, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
plot(m1)
car::vif(m1)
cormat<- rcorr(as.matrix(train.data[,c("REXONADISP","REXONAFEAT",
'REXONADF','REXONAPrice',
'DOVEPrice','AXEDISP')]))
flattenCorrMatrix <- function(cormat, pmat) {
ut <- upper.tri(cormat)
data.frame(
row = rownames(cormat)[row(cormat)[ut]],
column = rownames(cormat)[col(cormat)[ut]],
cor  =(cormat)[ut],
p = pmat[ut]
)
}
flattenCorrMatrix(cormat$r, cormat$P)
#Heterosedasticity test
gqtest(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+pricewar_dum+REXONADiscount,data=train.data)
bptest(m1)
train.data$resi <- m1$residuals
ggplot(data = train.data, aes(y = resi, x = REXONASales)) + geom_point(col = 'blue') + geom_abline(slope = 0)
# Out of sample performance
predictions <- m1 %>% predict(test.data)
data.frame(
RMSE = RMSE(predictions, test.data$REXONASales),
R2 = R2(predictions, test.data$REXONASales)
)
MAPE(predictions,test.data$REXONASales)
#########Multiplicative model####################
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount),train.data) #R2=0.72
summary(m2)
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount),train.data) #R2=0.72
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
summary(m2)
train.data <- train.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
train.data <- train.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
train.data <- train.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
train.data <- train.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_train = sum(train.data$ape)/length(train.data$ape)
mape_train
rmse_train <- sqrt(sum(train.data$se)/length(train.data$se))
rmse_train
cor(train.data$REXONASales,train.data$predicted_sales)^2
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
test.data <- test.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
test.data <- test.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_test = sum(test.data$ape)/length(test.data$ape)
mape_test
rmse_test <- sqrt(sum(test.data$se)/length(test.data$se))
rmse_test
cor(test.data$REXONASales,test.data$predicted_sales)^2
cor(test.data$REXONASales,test.data$predicted_sales)^2
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
data1_log= log(data1[,c(-1,-2)])
data1_log= cbind(data1_log[1:8],data1[11:50])
data1_scaled= scale(data1[,-1])
data1_scaled_log= scale(data1_log)
data1_scaled = as.data.frame(data1_scaled)
data1_scaled_log = as.data.frame(data1_scaled_log)
gpairs(data1[3:10])
gpairs(data1_log[2:9])
gpairs(data1_scaled_log[1:8])
#add new computed columns
df = subset(data1,REXONARPrice !=0)
data1 = data1%>%
mutate(REXONARPrice = ifelse(data1$REXONARPrice == 0,mean(df$REXONARPrice),data1$REXONARPrice))
data1 = data1%>%
mutate(REXONADiscount = (data1$REXONARPrice-data1$REXONAPrice)/data1$REXONARPrice)
df2= data1[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
# Split the data into training and test set
train.data  <- data1[1:100, ]
train.data = train.data%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
test.data <- data1[101:124, ]
chart.Correlation(train.data[,c(6,14,29,45,37,34,19)], histogram=TRUE, pch=19)  # Transforing is necessary
#Model1
m1 = lm(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+REXONADiscount,train.data) #R2=0.77
summary(m1)
RSS <- c(crossprod(m1$residuals))
MSE <- RSS / length(m1$residuals)
RMSE1 <- sqrt(MSE)
sig2 <- RSS / m1$df.residual
predictions1 <- m1 %>% predict(train.data)
data.frame(
RMSE = RMSE(predictions1, train.data$REXONASales),
R2 = R2(predictions1, train.data$REXONASales)
)
MAPE(predictions1,train.data$REXONASales)
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
summary(m2)
coefplot(m2, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
#Heterosedasticity test
gqtest(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),data=train.data)
train.data <- train.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
train.data <- train.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
train.data <- train.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
train.data <- train.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_train = sum(train.data$ape)/length(train.data$ape)
mape_train
rmse_train <- sqrt(sum(train.data$se)/length(train.data$se))
rmse_train
cor(train.data$REXONASales,train.data$predicted_sales)^2
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
test.data <- test.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
test.data <- test.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_test = sum(test.data$ape)/length(test.data$ape)
mape_test
rmse_test <- sqrt(sum(test.data$se)/length(test.data$se))
rmse_test
cor(test.data$REXONASales,test.data$predicted_sales)^2
train.data <- train.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
View(test.data)
#add new computed columns
df = subset(data1,REXONARPrice !=0)
data1 = data1%>%
mutate(REXONARPrice = ifelse(data1$REXONARPrice == 0,mean(df$REXONARPrice),data1$REXONARPrice))
data1 = data1%>%
mutate(REXONADiscount = (data1$REXONARPrice-data1$REXONAPrice)/data1$REXONARPrice)
data1 = data1%>%
mutate(pricewar_dum = ifelse(train.data$WEEK>56,1,0))
df2= data1[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
# Split the data into training and test set
train.data  <- data1[1:100, ]
test.data <- data1[101:124, ]
chart.Correlation(train.data[,c(6,14,29,45,37,34,19)], histogram=TRUE, pch=19)  # Transforing is necessary
#Model1
m1 = lm(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+REXONADiscount,train.data) #R2=0.77
summary(m1)
RSS <- c(crossprod(m1$residuals))
MSE <- RSS / length(m1$residuals)
RMSE1 <- sqrt(MSE)
sig2 <- RSS / m1$df.residual
predictions1 <- m1 %>% predict(train.data)
data.frame(
RMSE = RMSE(predictions1, train.data$REXONASales),
R2 = R2(predictions1, train.data$REXONASales)
)
MAPE(predictions1,train.data$REXONASales)
dwtest(m1)
dwtest(m2)
dwtest(m3)
acf(m1$residuals)
acf(m2$residuals)
acf(m3$residuals)
coefplot(m1, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
plot(m1)
car::vif(m1)
cormat<- rcorr(as.matrix(train.data[,c("REXONADISP","REXONAFEAT",
'REXONADF','REXONAPrice',
'DOVEPrice','AXEDISP')]))
flattenCorrMatrix <- function(cormat, pmat) {
ut <- upper.tri(cormat)
data.frame(
row = rownames(cormat)[row(cormat)[ut]],
column = rownames(cormat)[col(cormat)[ut]],
cor  =(cormat)[ut],
p = pmat[ut]
)
}
flattenCorrMatrix(cormat$r, cormat$P)
#Heterosedasticity test
gqtest(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+pricewar_dum+REXONADiscount,data=train.data)
bptest(m1)
train.data$resi <- m1$residuals
ggplot(data = train.data, aes(y = resi, x = REXONASales)) + geom_point(col = 'blue') + geom_abline(slope = 0)
# Out of sample performance
predictions <- m1 %>% predict(test.data)
data.frame(
RMSE = RMSE(predictions, test.data$REXONASales),
R2 = R2(predictions, test.data$REXONASales)
)
MAPE(predictions,test.data$REXONASales)
#########Multiplicative model####################
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
summary(m2)
coefplot(m2, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
#Heterosedasticity test
gqtest(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),data=train.data)
train.data <- train.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
train.data <- train.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
train.data <- train.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
train.data <- train.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_train = sum(train.data$ape)/length(train.data$ape)
mape_train
rmse_train <- sqrt(sum(train.data$se)/length(train.data$se))
rmse_train
cor(train.data$REXONASales,train.data$predicted_sales)^2
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
test.data <- test.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
test.data <- test.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_test = sum(test.data$ape)/length(test.data$ape)
mape_test
rmse_test <- sqrt(sum(test.data$se)/length(test.data$se))
rmse_test
cor(test.data$REXONASales,test.data$predicted_sales)^2
View(data1)
df = subset(data1,REXONARPrice !=0)
data1 = data1%>%
mutate(REXONARPrice = ifelse(data1$REXONARPrice == 0,mean(df$REXONARPrice),data1$REXONARPrice))
data1 = data1%>%
mutate(REXONADiscount = (data1$REXONARPrice-data1$REXONAPrice)/data1$REXONARPrice)
data1 = data1%>%
mutate(pricewar_dum = ifelse(data1$WEEK>56,1,0))
View(data1)
df2= data1[,c('WEEK','REXONARPrice','REXONAPrice','REXONADiscount')]
# Split the data into training and test set
train.data  <- data1[1:100, ]
test.data <- data1[101:124, ]
chart.Correlation(train.data[,c(6,14,29,45,37,34,19)], histogram=TRUE, pch=19)  # Transforing is necessary
#Model1
m1 = lm(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+REXONADiscount,train.data) #R2=0.77
summary(m1)
RSS <- c(crossprod(m1$residuals))
MSE <- RSS / length(m1$residuals)
RMSE1 <- sqrt(MSE)
sig2 <- RSS / m1$df.residual
predictions1 <- m1 %>% predict(train.data)
data.frame(
RMSE = RMSE(predictions1, train.data$REXONASales),
R2 = R2(predictions1, train.data$REXONASales)
)
MAPE(predictions1,train.data$REXONASales)
dwtest(m1)
dwtest(m2)
dwtest(m3)
acf(m1$residuals)
acf(m2$residuals)
acf(m3$residuals)
coefplot(m1, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
plot(m1)
car::vif(m1)
cormat<- rcorr(as.matrix(train.data[,c("REXONADISP","REXONAFEAT",
'REXONADF','REXONAPrice',
'DOVEPrice','AXEDISP')]))
flattenCorrMatrix <- function(cormat, pmat) {
ut <- upper.tri(cormat)
data.frame(
row = rownames(cormat)[row(cormat)[ut]],
column = rownames(cormat)[col(cormat)[ut]],
cor  =(cormat)[ut],
p = pmat[ut]
)
}
flattenCorrMatrix(cormat$r, cormat$P)
#Heterosedasticity test
gqtest(REXONASales~REXONADISP+REXONAFEAT+REXONADF+REXONARPrice+DOVEPrice+AXEDISP+pricewar_dum+REXONADiscount,data=train.data)
bptest(m1)
train.data$resi <- m1$residuals
ggplot(data = train.data, aes(y = resi, x = REXONASales)) + geom_point(col = 'blue') + geom_abline(slope = 0)
# Out of sample performance
predictions <- m1 %>% predict(test.data)
data.frame(
RMSE = RMSE(predictions, test.data$REXONASales),
R2 = R2(predictions, test.data$REXONASales)
)
MAPE(predictions,test.data$REXONASales)
#########Multiplicative model####################
m2 = lm(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),train.data) #R2=0.72
summary(m2)
coefplot(m2, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
#Heterosedasticity test
gqtest(log(REXONASales)~log(REXONADISP+1)+log(REXONAFEAT+1)+log(REXONADF+1)+log(AXEDISP+1)+log(DOVEPrice)+log(REXONARPrice)+log(pricewar_dum+1)+log(REXONADiscount+1),data=train.data)
train.data <- train.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
train.data <- train.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
train.data <- train.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
train.data <- train.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_train = sum(train.data$ape)/length(train.data$ape)
mape_train
rmse_train <- sqrt(sum(train.data$se)/length(train.data$se))
rmse_train
cor(train.data$REXONASales,train.data$predicted_sales)^2
test.data <- test.data %>%
mutate(lnsales = -0.6615 + 0.9098 * log(REXONADISP + 1) -1.0747 * log(REXONAFEAT + 1) +
2.2615 * log(REXONADF + 1) -0.5158 * log(AXEDISP + 1) + 0.5884 * log(DOVEPrice) -1.6773 * log(REXONARPrice)+-0.2713*log(pricewar_dum+1)+2.5061*log(REXONADiscount+1))
test.data <- test.data %>%
mutate(predicted_sales = exp(1) ^ lnsales)
test.data <- test.data %>%
mutate(se = (REXONASales - predicted_sales)^2)
test.data <- test.data %>%
mutate(ape = abs((REXONASales - predicted_sales)/REXONASales))
mape_test = sum(test.data$ape)/length(test.data$ape)
mape_test
rmse_test <- sqrt(sum(test.data$se)/length(test.data$se))
rmse_test
cor(test.data$REXONASales,test.data$predicted_sales)^2
coefplot(m2, intercept= F,outerCI=1.96, lwdOuter = 1.5,
ylab= "Variables",xlab= 'Association with Rexona market share')
